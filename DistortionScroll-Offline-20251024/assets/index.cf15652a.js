import{V as tn,W as rn,C as nn,S as on,P as sn,A as an,G as ln,T as cn,a as _r,b as un,c as dn,M as fn}from"./three.b864c352.js";import{g as hn}from"./gsap.a09a2f26.js";import{L as pn}from"./lenis.91e9159d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}})();class Ve{static get RENDERER_SETTING(){return{clearColor:0,width:window.innerWidth,height:window.innerHeight}}static get CAMERA_PARAM(){return{fovy:60,aspect:window.innerWidth/window.innerHeight,near:.1,far:1e4,x:0,y:0,z:1,lookAt:new tn(0,0,0)}}constructor(){this.render,this.scene,this.canvas,this.controls,this.axesHelper,this.gridHelper,this.render=this.render.bind(this)}_setRender(){this.renderer=new rn({antialias:!0,alpha:!0}),this.renderer.setClearColor(new nn(Ve.RENDERER_SETTING.clearColor)),this.renderer.setSize(Ve.RENDERER_SETTING.width,Ve.RENDERER_SETTING.height),this.renderer.setPixelRatio(window.devicePixelRatio),this.canvas=document.querySelector("#canvas"),this.canvas.appendChild(this.renderer.domElement)}_setScene(){this.scene=new on}_setCamera(){this.camera=new sn(Ve.CAMERA_PARAM.fovy,Ve.CAMERA_PARAM.aspect,Ve.CAMERA_PARAM.near,Ve.CAMERA_PARAM.far),this.camera.position.set(Ve.CAMERA_PARAM.x,Ve.CAMERA_PARAM.y,Ve.CAMERA_PARAM.z),this.camera.lookAt(Ve.CAMERA_PARAM.lookAt),this.camera.updateProjectionMatrix()}_setHelper(){this.axesHelper=new an(1e3),this.scene.add(this.axesHelper),this.gridHelper=new ln(10,10),this.scene.add(this.gridHelper)}_init(){this._setRender(),this._setScene(),this._setCamera()}render(){this.renderer.render(this.scene,this.camera)}onLoop(){this.render()}onResize(){this.width=window.innerWidth,this.height=window.innerHeight,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix()}}const gn=` varying vec2 vUv;
 varying float vNoise;
 uniform float uChangeTransition;
 uniform float uChangeTransition02;
 uniform sampler2D disp;

uniform float uTime;
uniform float uAmplitude;

  void main(void) {
    vUv = uv;
    vec3 pos = position;


    gl_Position = vec4( pos, 1.0 );
  }`,mn=` uniform vec2 uResolution;
 uniform vec2 uImageResolution;
 uniform vec2 uBounce;
 uniform float uTime;
 
// \u7EB9\u7406\u6570\u7EC4 - \u652F\u6301\u4EFB\u610F\u6570\u91CF\u7684\u56FE\u7247
uniform sampler2D uTextures[6];
uniform int uCurrentIndex;
uniform int uTargetIndex;
uniform float uTransition;
 
 uniform sampler2D disp;

 varying vec2 vUv;



// \u83B7\u53D6\u7EB9\u7406\u6570\u7EC4\u4E2D\u7684\u6307\u5B9A\u7D22\u5F15\u7EB9\u7406
vec4 getTexture(int index, vec2 uv) {
    // \u4F7F\u7528\u6761\u4EF6\u5224\u65AD\u6765\u8BBF\u95EE\u7EB9\u7406\u6570\u7EC4
    if (index == 0) return texture2D(uTextures[0], uv);
    else if (index == 1) return texture2D(uTextures[1], uv);
    else if (index == 2) return texture2D(uTextures[2], uv);
    else if (index == 3) return texture2D(uTextures[3], uv);
    else if (index == 4) return texture2D(uTextures[4], uv);
    else if (index == 5) return texture2D(uTextures[5], uv);
    else return texture2D(uTextures[0], uv); // \u9ED8\u8BA4\u8FD4\u56DE\u7B2C\u4E00\u5F20
}

void main(void) {
    vec2 ratio = vec2(
        min((uResolution.x / uResolution.y) / (uImageResolution.x / uImageResolution.y), 1.0),
        min((uResolution.y / uResolution.x) / (uImageResolution.y / uImageResolution.x), 1.0)
    );

    vec2 uv = vec2(
        vUv.x * ratio.x + (1.0 - ratio.x) * 0.5,
        vUv.y * ratio.y + (1.0 - ratio.y) * 0.5
    );

    float intensity = 0.7;

    vec4 disp = texture2D(disp, uv);
    vec2 dispVec = vec2(disp.x, disp.y);
    float dispClamp = clamp(dispVec.x,dispVec.y,vUv.y);
    float dist = distance(uv,dispVec) + dispClamp * sin(uTime * 10.0);

    vec2 changeVec = vec2(0.0, -1.0);//\u771F\u4E0B\u304B\u3089\u771F\u4E0A\u306B\u304B\u3051\u3066\u5909\u5316\u3055\u305B\u308B

    // \u8BA1\u7B97\u5F53\u524D\u548C\u4E0B\u4E00\u5F20\u56FE\u7247\u7684\u7D22\u5F15
    int currentIdx = clamp(uCurrentIndex, 0, 5);
    int nextIdx = clamp(uTargetIndex, 0, 5);

    // \u5E94\u7528\u7F6E\u6362\u6548\u679C
    vec2 distPos1 = uv + (dist * intensity * uTransition) * changeVec;
    vec2 distPos2 = uv + (dist * -(intensity * (1.0 - uTransition))) * changeVec;

    // \u83B7\u53D6\u5F53\u524D\u548C\u4E0B\u4E00\u5F20\u56FE\u7247\u7684\u989C\u8272
    vec4 currentColor = getTexture(currentIdx, distPos1);
    vec4 nextColor = getTexture(nextIdx, distPos2);

    // \u6DF7\u5408\u5F53\u524D\u548C\u4E0B\u4E00\u5F20\u56FE\u7247
    vec4 finalColor = mix(currentColor, nextColor, uTransition);

    // \u8C03\u8BD5\uFF1A\u663E\u793A\u7D22\u5F15\u4FE1\u606F\uFF08\u53EF\u9009\uFF09
    // if (uCurrentIndex < 0 || uCurrentIndex > 5) {
    //     finalColor = vec4(1.0, 0.0, 0.0, 1.0); // \u7EA2\u8272\u8868\u793A\u7D22\u5F15\u9519\u8BEF
    // }

    gl_FragColor = finalColor;
}
`;function pi(o,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(o,t.key,t)}}function _n(o,e,r){return e&&pi(o.prototype,e),r&&pi(o,r),o}/*!
 * Observer 3.11.2
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var me,Zr,Le,wt,Tt,Ut,ki,Pt,cr,Di,lt,Ge,Vi=function(){return me||typeof window<"u"&&(me=window.gsap)&&me.registerPlugin&&me},Oi=1,Wt=[],M=[],it=[],ur=Date.now,Jr=function(e,r){return r},vn=function(){var e=cr.core,r=e.bridge||{},t=e._scrollers,i=e._proxies;t.push.apply(t,M),i.push.apply(i,it),M=t,it=i,Jr=function(a,s){return r[a](s)}},St=function(e,r){return~it.indexOf(e)&&it[it.indexOf(e)+1][r]},dr=function(e){return!!~Di.indexOf(e)},Ie=function(e,r,t,i,n){return e.addEventListener(r,t,{passive:!i,capture:!!n})},Te=function(e,r,t,i){return e.removeEventListener(r,t,!!i)},vr="scrollLeft",xr="scrollTop",Qr=function(){return lt&&lt.isPressed||M.cache++},Hr=function(e,r){var t=function i(n){if(n||n===0){Oi&&(Le.history.scrollRestoration="manual");var a=lt&&lt.isPressed;n=i.v=Math.round(n)||(lt&&lt.iOS?1:0),e(n),i.cacheID=M.cache,a&&Jr("ss",n)}else(r||M.cache!==i.cacheID||Jr("ref"))&&(i.cacheID=M.cache,i.v=e());return i.v+i.offset};return t.offset=0,e&&t},Ee={s:vr,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:Hr(function(o){return arguments.length?Le.scrollTo(o,oe.sc()):Le.pageXOffset||wt[vr]||Tt[vr]||Ut[vr]||0})},oe={s:xr,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:Ee,sc:Hr(function(o){return arguments.length?Le.scrollTo(Ee.sc(),o):Le.pageYOffset||wt[xr]||Tt[xr]||Ut[xr]||0})},Ae=function(e){return me.utils.toArray(e)[0]||(typeof e=="string"&&me.config().nullTargetWarn!==!1?console.warn("Element not found:",e):null)},Ct=function(e,r){var t=r.s,i=r.sc;dr(e)&&(e=wt.scrollingElement||Tt);var n=M.indexOf(e),a=i===oe.sc?1:2;!~n&&(n=M.push(e)-1),M[n+a]||e.addEventListener("scroll",Qr);var s=M[n+a],f=s||(M[n+a]=Hr(St(e,t),!0)||(dr(e)?i:Hr(function(w){return arguments.length?e[t]=w:e[t]})));return f.target=e,s||(f.smooth=me.getProperty(e,"scrollBehavior")==="smooth"),f},ei=function(e,r,t){var i=e,n=e,a=ur(),s=a,f=r||50,w=Math.max(500,f*3),m=function(p,Y){var H=ur();Y||H-a>f?(n=i,i=p,s=a,a=H):t?i+=p:i=n+(p-n)/(H-s)*(a-s)},g=function(){n=i=t?0:i,s=a=0},h=function(p){var Y=s,H=n,E=ur();return(p||p===0)&&p!==i&&m(p),a===s||E-s>w?0:(i+(t?H:-H))/((t?E:a)-Y)*1e3};return{update:m,reset:g,getVelocity:h}},ir=function(e,r){return r&&!e._gsapAllow&&e.preventDefault(),e.changedTouches?e.changedTouches[0]:e},gi=function(e){var r=Math.max.apply(Math,e),t=Math.min.apply(Math,e);return Math.abs(r)>=Math.abs(t)?r:t},Li=function(){cr=me.core.globals().ScrollTrigger,cr&&cr.core&&vn()},Bi=function(e){return me=e||Vi(),me&&typeof document<"u"&&document.body&&(Le=window,wt=document,Tt=wt.documentElement,Ut=wt.body,Di=[Le,wt,Tt,Ut],me.utils.clamp,Pt="onpointerenter"in Ut?"pointer":"mouse",ki=te.isTouch=Le.matchMedia&&Le.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in Le||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,Ge=te.eventTypes=("ontouchstart"in Tt?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in Tt?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return Oi=0},500),Li(),Zr=1),Zr};Ee.op=oe;M.cache=0;var te=function(){function o(r){this.init(r)}var e=o.prototype;return e.init=function(t){Zr||Bi(me)||console.warn("Please gsap.registerPlugin(Observer)"),cr||Li();var i=t.tolerance,n=t.dragMinimum,a=t.type,s=t.target,f=t.lineHeight,w=t.debounce,m=t.preventDefault,g=t.onStop,h=t.onStopDelay,d=t.ignore,p=t.wheelSpeed,Y=t.event,H=t.onDragStart,E=t.onDragEnd,ae=t.onDrag,j=t.onPress,P=t.onRelease,_e=t.onRight,N=t.onLeft,S=t.onUp,Pe=t.onDown,Xe=t.onChangeX,C=t.onChangeY,L=t.onChange,k=t.onToggleX,qe=t.onToggleY,ue=t.onHover,le=t.onHoverEnd,V=t.onMove,ve=t.ignoreCheck,z=t.isNormalizer,re=t.onGestureStart,l=t.onGestureEnd,He=t.onWheel,ut=t.onEnable,dt=t.onDisable,ft=t.onClick,ht=t.scrollSpeed,F=t.capture,de=t.allowClicks,xe=t.lockAxis,Kt=t.onLockAxis;this.target=s=Ae(s)||Tt,this.vars=t,d&&(d=me.utils.toArray(d)),i=i||1e-9,n=n||0,p=p||1,ht=ht||1,a=a||"wheel,touch,pointer",w=w!==!1,f||(f=parseFloat(Le.getComputedStyle(Ut).lineHeight)||22);var Me,ze,D,fe,Re,je,ye,c=this,nt=0,X=0,pt=Ct(s,Ee),gt=Ct(s,oe),Lt=pt(),we=gt(),Zt=~a.indexOf("touch")&&!~a.indexOf("pointer")&&Ge[0]==="pointerdown",mt=dr(s),K=s.ownerDocument||wt,ke=[0,0,0],he=[0,0,0],Jt=0,_t=function(){return Jt=ur()},Ke=function(u,_){return(c.event=u)&&d&&~d.indexOf(u.target)||_&&Zt&&u.pointerType!=="touch"||ve&&ve(u,_)},Qt=function(){c._vx.reset(),c._vy.reset(),ze.pause(),g&&g(c)},vt=function(){var u=c.deltaX=gi(ke),_=c.deltaY=gi(he),v=Math.abs(u)>=i,y=Math.abs(_)>=i;L&&(v||y)&&L(c,u,_,ke,he),v&&(_e&&c.deltaX>0&&_e(c),N&&c.deltaX<0&&N(c),Xe&&Xe(c),k&&c.deltaX<0!=nt<0&&k(c),nt=c.deltaX,ke[0]=ke[1]=ke[2]=0),y&&(Pe&&c.deltaY>0&&Pe(c),S&&c.deltaY<0&&S(c),C&&C(c),qe&&c.deltaY<0!=X<0&&qe(c),X=c.deltaY,he[0]=he[1]=he[2]=0),(fe||D)&&(V&&V(c),D&&(ae(c),D=!1),fe=!1),je&&!(je=!1)&&Kt&&Kt(c),Re&&(He(c),Re=!1),Me=0},Et=function(u,_,v){ke[v]+=u,he[v]+=_,c._vx.update(u),c._vy.update(_),w?Me||(Me=requestAnimationFrame(vt)):vt()},Bt=function(u,_){xe&&!ye&&(c.axis=ye=Math.abs(u)>Math.abs(_)?"x":"y",je=!0),ye!=="y"&&(ke[2]+=u,c._vx.update(u,!0)),ye!=="x"&&(he[2]+=_,c._vy.update(_,!0)),w?Me||(Me=requestAnimationFrame(vt)):vt()},O=function(u){if(!Ke(u,1)){u=ir(u,m);var _=u.clientX,v=u.clientY,y=_-c.x,ie=v-c.y,T=c.isDragging;c.x=_,c.y=v,(T||Math.abs(c.startX-_)>=n||Math.abs(c.startY-v)>=n)&&(ae&&(D=!0),T||(c.isDragging=!0),Bt(y,ie),T||H&&H(c))}},xt=c.onPress=function(R){Ke(R,1)||(c.axis=ye=null,ze.pause(),c.isPressed=!0,R=ir(R),nt=X=0,c.startX=c.x=R.clientX,c.startY=c.y=R.clientY,c._vx.reset(),c._vy.reset(),Ie(z?s:K,Ge[1],O,m,!0),c.deltaX=c.deltaY=0,j&&j(c))},De=function(u){if(!Ke(u,1)){Te(z?s:K,Ge[1],O,!0);var _=c.isDragging&&(Math.abs(c.x-c.startX)>3||Math.abs(c.y-c.startY)>3),v=ir(u);_||(c._vx.reset(),c._vy.reset(),m&&de&&me.delayedCall(.08,function(){if(ur()-Jt>300&&!u.defaultPrevented){if(u.target.click)u.target.click();else if(K.createEvent){var y=K.createEvent("MouseEvents");y.initMouseEvent("click",!0,!0,Le,1,v.screenX,v.screenY,v.clientX,v.clientY,!1,!1,!1,!1,0,null),u.target.dispatchEvent(y)}}})),c.isDragging=c.isGesturing=c.isPressed=!1,g&&!z&&ze.restart(!0),E&&_&&E(c),P&&P(c,_)}},We=function(u){return u.touches&&u.touches.length>1&&(c.isGesturing=!0)&&re(u,c.isDragging)},Ze=function(){return(c.isGesturing=!1)||l(c)},Je=function(u){if(!Ke(u)){var _=pt(),v=gt();Et((_-Lt)*ht,(v-we)*ht,1),Lt=_,we=v,g&&ze.restart(!0)}},It=function(u){if(!Ke(u)){u=ir(u,m),He&&(Re=!0);var _=(u.deltaMode===1?f:u.deltaMode===2?Le.innerHeight:1)*p;Et(u.deltaX*_,u.deltaY*_,0),g&&!z&&ze.restart(!0)}},Ht=function(u){if(!Ke(u)){var _=u.clientX,v=u.clientY,y=_-c.x,ie=v-c.y;c.x=_,c.y=v,fe=!0,(y||ie)&&Bt(y,ie)}},ot=function(u){c.event=u,ue(c)},er=function(u){c.event=u,le(c)},tr=function(u){return Ke(u)||ir(u,m)&&ft(c)};ze=c._dc=me.delayedCall(h||.25,Qt).pause(),c.deltaX=c.deltaY=0,c._vx=ei(0,50,!0),c._vy=ei(0,50,!0),c.scrollX=pt,c.scrollY=gt,c.isDragging=c.isGesturing=c.isPressed=!1,c.enable=function(R){return c.isEnabled||(Ie(mt?K:s,"scroll",Qr),a.indexOf("scroll")>=0&&Ie(mt?K:s,"scroll",Je,m,F),a.indexOf("wheel")>=0&&Ie(s,"wheel",It,m,F),(a.indexOf("touch")>=0&&ki||a.indexOf("pointer")>=0)&&(Ie(s,Ge[0],xt,m,F),Ie(K,Ge[2],De),Ie(K,Ge[3],De),de&&Ie(s,"click",_t,!1,!0),ft&&Ie(s,"click",tr),re&&Ie(K,"gesturestart",We),l&&Ie(K,"gestureend",Ze),ue&&Ie(s,Pt+"enter",ot),le&&Ie(s,Pt+"leave",er),V&&Ie(s,Pt+"move",Ht)),c.isEnabled=!0,R&&R.type&&xt(R),ut&&ut(c)),c},c.disable=function(){c.isEnabled&&(Wt.filter(function(R){return R!==c&&dr(R.target)}).length||Te(mt?K:s,"scroll",Qr),c.isPressed&&(c._vx.reset(),c._vy.reset(),Te(z?s:K,Ge[1],O,!0)),Te(mt?K:s,"scroll",Je,F),Te(s,"wheel",It,F),Te(s,Ge[0],xt,F),Te(K,Ge[2],De),Te(K,Ge[3],De),Te(s,"click",_t,!0),Te(s,"click",tr),Te(K,"gesturestart",We),Te(K,"gestureend",Ze),Te(s,Pt+"enter",ot),Te(s,Pt+"leave",er),Te(s,Pt+"move",Ht),c.isEnabled=c.isPressed=c.isDragging=!1,dt&&dt(c))},c.kill=function(){c.disable();var R=Wt.indexOf(c);R>=0&&Wt.splice(R,1),lt===c&&(lt=0)},Wt.push(c),z&&dr(s)&&(lt=c),c.enable(Y)},_n(o,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),o}();te.version="3.11.2";te.create=function(o){return new te(o)};te.register=Bi;te.getAll=function(){return Wt.slice()};te.getById=function(o){return Wt.filter(function(e){return e.vars.id===o})[0]};Vi()&&me.registerPlugin(te);/*!
 * ScrollTrigger 3.11.2
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var x,Nt,A,U,ct,q,Hi,zr,Fr,$t,Mr,yr,ge,Nr,ti,Se,mi,_i,Xt,zi,Wr,Fi,Fe,Yi,Ni,Xi,yt,ri,ai,$r,wr=1,Ce=Date.now,Gr=Ce(),Ne=0,Tr=0,vi=function(){return Nr=1},xi=function(){return Nr=0},et=function(e){return e},sr=function(e){return Math.round(e*1e5)/1e5||0},Wi=function(){return typeof window<"u"},$i=function(){return x||Wi()&&(x=window.gsap)&&x.registerPlugin&&x},Dt=function(e){return!!~Hi.indexOf(e)},Gi=function(e){return St(e,"getBoundingClientRect")||(Dt(e)?function(){return Br.width=A.innerWidth,Br.height=A.innerHeight,Br}:function(){return at(e)})},xn=function(e,r,t){var i=t.d,n=t.d2,a=t.a;return(a=St(e,"getBoundingClientRect"))?function(){return a()[i]}:function(){return(r?A["inner"+n]:e["client"+n])||0}},yn=function(e,r){return!r||~it.indexOf(e)?Gi(e):function(){return Br}},bt=function(e,r){var t=r.s,i=r.d2,n=r.d,a=r.a;return(t="scroll"+i)&&(a=St(e,t))?a()-Gi(e)()[n]:Dt(e)?(ct[t]||q[t])-(A["inner"+i]||ct["client"+i]||q["client"+i]):e[t]-e["offset"+i]},br=function(e,r){for(var t=0;t<Xt.length;t+=3)(!r||~r.indexOf(Xt[t+1]))&&e(Xt[t],Xt[t+1],Xt[t+2])},Ue=function(e){return typeof e=="string"},Be=function(e){return typeof e=="function"},ar=function(e){return typeof e=="number"},Rr=function(e){return typeof e=="object"},nr=function(e,r,t){return e&&e.progress(r?0:1)&&t&&e.pause()},Ur=function(e,r){if(e.enabled){var t=r(e);t&&t.totalTime&&(e.callbackAnimation=t)}},Ft=Math.abs,Ui="left",qi="top",li="right",ci="bottom",Rt="width",kt="height",fr="Right",hr="Left",pr="Top",gr="Bottom",ee="padding",Ye="margin",qt="Width",ui="Height",be="px",rt=function(e){return A.getComputedStyle(e)},wn=function(e){var r=rt(e).position;e.style.position=r==="absolute"||r==="fixed"?r:"relative"},yi=function(e,r){for(var t in r)t in e||(e[t]=r[t]);return e},at=function(e,r){var t=r&&rt(e)[ti]!=="matrix(1, 0, 0, 1, 0, 0)"&&x.to(e,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),i=e.getBoundingClientRect();return t&&t.progress(0).kill(),i},ii=function(e,r){var t=r.d2;return e["offset"+t]||e["client"+t]||0},ji=function(e){var r=[],t=e.labels,i=e.duration(),n;for(n in t)r.push(t[n]/i);return r},Tn=function(e){return function(r){return x.utils.snap(ji(e),r)}},di=function(e){var r=x.utils.snap(e),t=Array.isArray(e)&&e.slice(0).sort(function(i,n){return i-n});return t?function(i,n,a){a===void 0&&(a=.001);var s;if(!n)return r(i);if(n>0){for(i-=a,s=0;s<t.length;s++)if(t[s]>=i)return t[s];return t[s-1]}else for(s=t.length,i+=a;s--;)if(t[s]<=i)return t[s];return t[0]}:function(i,n,a){a===void 0&&(a=.001);var s=r(i);return!n||Math.abs(s-i)<a||s-i<0==n<0?s:r(n<0?i-e:i+e)}},bn=function(e){return function(r,t){return di(ji(e))(r,t.direction)}},Sr=function(e,r,t,i){return t.split(",").forEach(function(n){return e(r,n,i)})},ce=function(e,r,t,i,n){return e.addEventListener(r,t,{passive:!i,capture:!!n})},se=function(e,r,t,i){return e.removeEventListener(r,t,!!i)},Cr=function(e,r,t){return t&&t.wheelHandler&&e(r,"wheel",t)},wi={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},Er={toggleActions:"play",anticipatePin:0},Yr={top:0,left:0,center:.5,bottom:1,right:1},kr=function(e,r){if(Ue(e)){var t=e.indexOf("="),i=~t?+(e.charAt(t-1)+1)*parseFloat(e.substr(t+1)):0;~t&&(e.indexOf("%")>t&&(i*=r/100),e=e.substr(0,t-1)),e=i+(e in Yr?Yr[e]*r:~e.indexOf("%")?parseFloat(e)*r/100:parseFloat(e)||0)}return e},Ir=function(e,r,t,i,n,a,s,f){var w=n.startColor,m=n.endColor,g=n.fontSize,h=n.indent,d=n.fontWeight,p=U.createElement("div"),Y=Dt(t)||St(t,"pinType")==="fixed",H=e.indexOf("scroller")!==-1,E=Y?q:t,ae=e.indexOf("start")!==-1,j=ae?w:m,P="border-color:"+j+";font-size:"+g+";color:"+j+";font-weight:"+d+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return P+="position:"+((H||f)&&Y?"fixed;":"absolute;"),(H||f||!Y)&&(P+=(i===oe?li:ci)+":"+(a+parseFloat(h))+"px;"),s&&(P+="box-sizing:border-box;text-align:left;width:"+s.offsetWidth+"px;"),p._isStart=ae,p.setAttribute("class","gsap-marker-"+e+(r?" marker-"+r:"")),p.style.cssText=P,p.innerText=r||r===0?e+"-"+r:e,E.children[0]?E.insertBefore(p,E.children[0]):E.appendChild(p),p._offset=p["offset"+i.op.d2],Dr(p,0,i,ae),p},Dr=function(e,r,t,i){var n={display:"block"},a=t[i?"os2":"p2"],s=t[i?"p2":"os2"];e._isFlipped=i,n[t.a+"Percent"]=i?-100:0,n[t.a]=i?"1px":0,n["border"+a+qt]=1,n["border"+s+qt]=0,n[t.p]=r+"px",x.set(e,n)},I=[],ni={},oi,Ti=function(){return Ce()-Ne>34&&jt()},Yt=function(){(!Fe||!Fe.isPressed||Fe.startX>q.clientWidth)&&(M.cache++,oi||(oi=requestAnimationFrame(jt)),Ne||Ot("scrollStart"),Ne=Ce())},qr=function(){Xi=A.innerWidth,Ni=A.innerHeight},lr=function(){M.cache++,!ge&&!Fi&&!U.fullscreenElement&&!U.webkitFullscreenElement&&(!Yi||Xi!==A.innerWidth||Math.abs(A.innerHeight-Ni)>A.innerHeight*.25)&&zr.restart(!0)},Vt={},Sn=[],Ki=function o(){return se(b,"scrollEnd",o)||Gt(!0)},Ot=function(e){return Vt[e]&&Vt[e].map(function(r){return r()})||Sn},Oe=[],Zi=function(e){for(var r=0;r<Oe.length;r+=5)(!e||Oe[r+4]&&Oe[r+4].query===e)&&(Oe[r].style.cssText=Oe[r+1],Oe[r].getBBox&&Oe[r].setAttribute("transform",Oe[r+2]||""),Oe[r+3].uncache=1)},fi=function(e,r){var t;for(Se=0;Se<I.length;Se++)t=I[Se],t&&(!r||t._ctx===r)&&(e?t.kill(1):t.revert(!0,!0));r&&Zi(r),r||Ot("revert")},Ji=function(e,r){M.cache++,(r||!tt)&&M.forEach(function(t){return Be(t)&&t.cacheID++&&(t.rec=0)}),Ue(e)&&(A.history.scrollRestoration=ai=e)},tt,Vr=0,Gt=function(e,r){if(Ne&&!e){ce(b,"scrollEnd",Ki);return}tt=b.isRefreshing=!0,M.forEach(function(i){return Be(i)&&i.cacheID++&&(i.rec=i())});var t=Ot("refreshInit");zi&&b.sort(),r||fi(),M.forEach(function(i){Be(i)&&(i.smooth&&(i.target.style.scrollBehavior="auto"),i(0))}),I.slice(0).forEach(function(i){return i.refresh()}),I.forEach(function(i){return i.vars.end==="max"&&i.setPositions(i.start,Math.max(i.start+1,bt(i.scroller,i._dir)))}),t.forEach(function(i){return i&&i.render&&i.render(-1)}),M.forEach(function(i){Be(i)&&(i.smooth&&requestAnimationFrame(function(){return i.target.style.scrollBehavior="smooth"}),i.rec&&i(i.rec))}),Ji(ai,1),zr.pause(),Vr++,jt(2),tt=b.isRefreshing=!1,Ot("refresh")},bi=0,Or=1,Mt,jt=function(e){if(!tt||e===2){b.isUpdating=!0,Mt&&Mt.update(0);var r=I.length,t=Ce(),i=t-Gr>=50,n=r&&I[0].scroll();if(Or=bi>n?-1:1,bi=n,i&&(Ne&&!Nr&&t-Ne>200&&(Ne=0,Ot("scrollEnd")),Mr=Gr,Gr=t),Or<0){for(Se=r;Se-- >0;)I[Se]&&I[Se].update(0,i);Or=1}else for(Se=0;Se<r;Se++)I[Se]&&I[Se].update(0,i);b.isUpdating=!1}oi=0},si=[Ui,qi,ci,li,Ye+gr,Ye+fr,Ye+pr,Ye+hr,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],Lr=si.concat([Rt,kt,"boxSizing","max"+qt,"max"+ui,"position",Ye,ee,ee+pr,ee+fr,ee+gr,ee+hr]),Cn=function(e,r,t){mr(t);var i=e._gsap;if(i.spacerIsNative)mr(i.spacerState);else if(e._gsap.swappedIn){var n=r.parentNode;n&&(n.insertBefore(e,r),n.removeChild(r))}e._gsap.swappedIn=!1},jr=function(e,r,t,i){if(!e._gsap.swappedIn){for(var n=si.length,a=r.style,s=e.style,f;n--;)f=si[n],a[f]=t[f];a.position=t.position==="absolute"?"absolute":"relative",t.display==="inline"&&(a.display="inline-block"),s[ci]=s[li]="auto",a.flexBasis=t.flexBasis||"auto",a.overflow="visible",a.boxSizing="border-box",a[Rt]=ii(e,Ee)+be,a[kt]=ii(e,oe)+be,a[ee]=s[Ye]=s[qi]=s[Ui]="0",mr(i),s[Rt]=s["max"+qt]=t[Rt],s[kt]=s["max"+ui]=t[kt],s[ee]=t[ee],e.parentNode!==r&&(e.parentNode.insertBefore(r,e),r.appendChild(e)),e._gsap.swappedIn=!0}},En=/([A-Z])/g,mr=function(e){if(e){var r=e.t.style,t=e.length,i=0,n,a;for((e.t._gsap||x.core.getCache(e.t)).uncache=1;i<t;i+=2)a=e[i+1],n=e[i],a?r[n]=a:r[n]&&r.removeProperty(n.replace(En,"-$1").toLowerCase())}},Ar=function(e){for(var r=Lr.length,t=e.style,i=[],n=0;n<r;n++)i.push(Lr[n],t[Lr[n]]);return i.t=e,i},In=function(e,r,t){for(var i=[],n=e.length,a=t?8:0,s;a<n;a+=2)s=e[a],i.push(s,s in r?r[s]:e[a+1]);return i.t=e.t,i},Br={left:0,top:0},Si=function(e,r,t,i,n,a,s,f,w,m,g,h,d){Be(e)&&(e=e(f)),Ue(e)&&e.substr(0,3)==="max"&&(e=h+(e.charAt(4)==="="?kr("0"+e.substr(3),t):0));var p=d?d.time():0,Y,H,E;if(d&&d.seek(0),ar(e))s&&Dr(s,t,i,!0);else{Be(r)&&(r=r(f));var ae=(e||"0").split(" "),j,P,_e,N;E=Ae(r)||q,j=at(E)||{},(!j||!j.left&&!j.top)&&rt(E).display==="none"&&(N=E.style.display,E.style.display="block",j=at(E),N?E.style.display=N:E.style.removeProperty("display")),P=kr(ae[0],j[i.d]),_e=kr(ae[1]||"0",t),e=j[i.p]-w[i.p]-m+P+n-_e,s&&Dr(s,_e,i,t-_e<20||s._isStart&&_e>20),t-=t-_e}if(a){var S=e+t,Pe=a._isStart;Y="scroll"+i.d2,Dr(a,S,i,Pe&&S>20||!Pe&&(g?Math.max(q[Y],ct[Y]):a.parentNode[Y])<=S+1),g&&(w=at(s),g&&(a.style[i.op.p]=w[i.op.p]-i.op.m-a._offset+be))}return d&&E&&(Y=at(E),d.seek(h),H=at(E),d._caScrollDist=Y[i.p]-H[i.p],e=e/d._caScrollDist*h),d&&d.seek(p),d?e:Math.round(e)},An=/(webkit|moz|length|cssText|inset)/i,Ci=function(e,r,t,i){if(e.parentNode!==r){var n=e.style,a,s;if(r===q){e._stOrig=n.cssText,s=rt(e);for(a in s)!+a&&!An.test(a)&&s[a]&&typeof n[a]=="string"&&a!=="0"&&(n[a]=s[a]);n.top=t,n.left=i}else n.cssText=e._stOrig;x.core.getCache(e).uncache=1,r.appendChild(e)}},Ei=function(e,r){var t=Ct(e,r),i="_scroll"+r.p2,n,a,s=function f(w,m,g,h,d){var p=f.tween,Y=m.onComplete,H={};return g=g||t(),d=h&&d||0,h=h||w-g,p&&p.kill(),n=Math.round(g),m[i]=w,m.modifiers=H,H[i]=function(E){return E=Math.round(t()),E!==n&&E!==a&&Math.abs(E-n)>3&&Math.abs(E-a)>3?(p.kill(),f.tween=0):E=g+h*p.ratio+d*p.ratio*p.ratio,a=n,n=Math.round(E)},m.onComplete=function(){f.tween=0,Y&&Y.call(p)},p=f.tween=x.to(e,m),p};return e[i]=t,t.wheelHandler=function(){return s.tween&&s.tween.kill()&&(s.tween=0)},ce(e,"wheel",t.wheelHandler),s},b=function(){function o(r,t){Nt||o.register(x)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),this.init(r,t)}var e=o.prototype;return e.init=function(t,i){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!Tr){this.update=this.refresh=this.kill=et;return}t=yi(Ue(t)||ar(t)||t.nodeType?{trigger:t}:t,Er);var n=t,a=n.onUpdate,s=n.toggleClass,f=n.id,w=n.onToggle,m=n.onRefresh,g=n.scrub,h=n.trigger,d=n.pin,p=n.pinSpacing,Y=n.invalidateOnRefresh,H=n.anticipatePin,E=n.onScrubComplete,ae=n.onSnapComplete,j=n.once,P=n.snap,_e=n.pinReparent,N=n.pinSpacer,S=n.containerAnimation,Pe=n.fastScrollEnd,Xe=n.preventOverlaps,C=t.horizontal||t.containerAnimation&&t.horizontal!==!1?Ee:oe,L=!g&&g!==0,k=Ae(t.scroller||A),qe=x.core.getCache(k),ue=Dt(k),le=("pinType"in t?t.pinType:St(k,"pinType")||ue&&"fixed")==="fixed",V=[t.onEnter,t.onLeave,t.onEnterBack,t.onLeaveBack],ve=L&&t.toggleActions.split(" "),z="markers"in t?t.markers:Er.markers,re=ue?0:parseFloat(rt(k)["border"+C.p2+qt])||0,l=this,He=t.onRefreshInit&&function(){return t.onRefreshInit(l)},ut=xn(k,ue,C),dt=yn(k,ue),ft=0,ht=0,F=Ct(k,C),de,xe,Kt,Me,ze,D,fe,Re,je,ye,c,nt,X,pt,gt,Lt,we,Zt,mt,K,ke,he,Jt,_t,Ke,Qt,vt,Et,Bt,O,xt,De,We,Ze,Je,It,Ht,ot;if(ri(l),l._dir=C,H*=45,l.scroller=k,l.scroll=S?S.time.bind(S):F,Me=F(),l.vars=t,i=i||t.animation,"refreshPriority"in t&&(zi=1,t.refreshPriority===-9999&&(Mt=l)),qe.tweenScroll=qe.tweenScroll||{top:Ei(k,oe),left:Ei(k,Ee)},l.tweenTo=de=qe.tweenScroll[C.p],l.scrubDuration=function(u){xt=ar(u)&&u,xt?O?O.duration(u):O=x.to(i,{ease:"expo",totalProgress:"+=0.001",duration:xt,paused:!0,onComplete:function(){return E&&E(l)}}):(O&&O.progress(1).kill(),O=0)},i&&(i.vars.lazy=!1,i._initted||i.vars.immediateRender!==!1&&t.immediateRender!==!1&&i.duration()&&i.render(0,!0,!0),l.animation=i.pause(),i.scrollTrigger=l,l.scrubDuration(g),Et=0,f||(f=i.vars.id)),I.push(l),P&&((!Rr(P)||P.push)&&(P={snapTo:P}),"scrollBehavior"in q.style&&x.set(ue?[q,ct]:k,{scrollBehavior:"auto"}),Kt=Be(P.snapTo)?P.snapTo:P.snapTo==="labels"?Tn(i):P.snapTo==="labelsDirectional"?bn(i):P.directional!==!1?function(u,_){return di(P.snapTo)(u,Ce()-ht<500?0:_.direction)}:x.utils.snap(P.snapTo),De=P.duration||{min:.1,max:2},De=Rr(De)?$t(De.min,De.max):$t(De,De),We=x.delayedCall(P.delay||xt/2||.1,function(){var u=F(),_=Ce()-ht<500,v=de.tween;if((_||Math.abs(l.getVelocity())<10)&&!v&&!Nr&&ft!==u){var y=(u-D)/X,ie=i&&!L?i.totalProgress():y,T=_?0:(ie-Bt)/(Ce()-Mr)*1e3||0,Z=x.utils.clamp(-y,1-y,Ft(T/2)*T/.185),W=y+(P.inertia===!1?0:Z),Qe=$t(0,1,Kt(W,l)),B=Math.round(D+Qe*X),pe=P,$e=pe.onStart,$=pe.onInterrupt,G=pe.onComplete;if(u<=fe&&u>=D&&B!==u){if(v&&!v._initted&&v.data<=Ft(B-u))return;P.inertia===!1&&(Z=Qe-y),de(B,{duration:De(Ft(Math.max(Ft(W-ie),Ft(Qe-ie))*.185/T/.05||0)),ease:P.ease||"power3",data:Ft(B-u),onInterrupt:function(){return We.restart(!0)&&$&&$(l)},onComplete:function(){l.update(),ft=F(),Et=Bt=i&&!L?i.totalProgress():l.progress,ae&&ae(l),G&&G(l)}},u,Z*X,B-u-Z*X),$e&&$e(l,de.tween)}}else l.isActive&&ft!==u&&We.restart(!0)}).pause()),f&&(ni[f]=l),h=l.trigger=Ae(h||d),ot=h&&h._gsap&&h._gsap.stRevert,ot&&(ot=ot(l)),d=d===!0?h:Ae(d),Ue(s)&&(s={targets:h,className:s}),d&&(p===!1||p===Ye||(p=!p&&rt(d.parentNode).display==="flex"?!1:ee),l.pin=d,xe=x.core.getCache(d),xe.spacer?pt=xe.pinState:(N&&(N=Ae(N),N&&!N.nodeType&&(N=N.current||N.nativeElement),xe.spacerIsNative=!!N,N&&(xe.spacerState=Ar(N))),xe.spacer=we=N||U.createElement("div"),we.classList.add("pin-spacer"),f&&we.classList.add("pin-spacer-"+f),xe.pinState=pt=Ar(d)),t.force3D!==!1&&x.set(d,{force3D:!0}),l.spacer=we=xe.spacer,vt=rt(d),Jt=vt[p+C.os2],mt=x.getProperty(d),K=x.quickSetter(d,C.a,be),jr(d,we,vt),Lt=Ar(d)),z){nt=Rr(z)?yi(z,wi):wi,ye=Ir("scroller-start",f,k,C,nt,0),c=Ir("scroller-end",f,k,C,nt,0,ye),Zt=ye["offset"+C.op.d2];var er=Ae(St(k,"content")||k);Re=this.markerStart=Ir("start",f,er,C,nt,Zt,0,S),je=this.markerEnd=Ir("end",f,er,C,nt,Zt,0,S),S&&(Ht=x.quickSetter([Re,je],C.a,be)),!le&&!(it.length&&St(k,"fixedMarkers")===!0)&&(wn(ue?q:k),x.set([ye,c],{force3D:!0}),Ke=x.quickSetter(ye,C.a,be),Qt=x.quickSetter(c,C.a,be))}if(S){var tr=S.vars.onUpdate,R=S.vars.onUpdateParams;S.eventCallback("onUpdate",function(){l.update(0,0,1),tr&&tr.apply(R||[])})}l.previous=function(){return I[I.indexOf(l)-1]},l.next=function(){return I[I.indexOf(l)+1]},l.revert=function(u,_){if(!_)return l.kill(!0);var v=u!==!1||!l.enabled,y=ge;v!==l.isReverted&&(v&&(Je=Math.max(F(),l.scroll.rec||0),Ze=l.progress,It=i&&i.progress()),Re&&[Re,je,ye,c].forEach(function(ie){return ie.style.display=v?"none":"block"}),v&&(ge=1),l.update(v),ge=y,d&&(v?Cn(d,we,pt):(!_e||!l.isActive)&&jr(d,we,rt(d),_t)),l.isReverted=v)},l.refresh=function(u,_){if(!((ge||!l.enabled)&&!_)){if(d&&u&&Ne){ce(o,"scrollEnd",Ki);return}!tt&&He&&He(l),ge=1,ht=Ce(),de.tween&&(de.tween.kill(),de.tween=0),O&&O.pause(),Y&&i&&i.revert({kill:!1}).invalidate(),l.isReverted||l.revert(!0,!0);for(var v=ut(),y=dt(),ie=S?S.duration():bt(k,C),T=0,Z=0,W=t.end,Qe=t.endTrigger||h,B=t.start||(t.start===0||!h?0:d?"0 0":"0 100%"),pe=l.pinnedContainer=t.pinnedContainer&&Ae(t.pinnedContainer),$e=h&&Math.max(0,I.indexOf(l))||0,$=$e,G,J,zt,At,ne,Q,st,Xr,hi,rr;$--;)Q=I[$],Q.end||Q.refresh(0,1)||(ge=1),st=Q.pin,st&&(st===h||st===d)&&!Q.isReverted&&(rr||(rr=[]),rr.unshift(Q),Q.revert(!0,!0)),Q!==I[$]&&($e--,$--);for(Be(B)&&(B=B(l)),D=Si(B,h,v,C,F(),Re,ye,l,y,re,le,ie,S)||(d?-.001:0),Be(W)&&(W=W(l)),Ue(W)&&!W.indexOf("+=")&&(~W.indexOf(" ")?W=(Ue(B)?B.split(" ")[0]:"")+W:(T=kr(W.substr(2),v),W=Ue(B)?B:D+T,Qe=h)),fe=Math.max(D,Si(W||(Qe?"100% 0":ie),Qe,v,C,F()+T,je,c,l,y,re,le,ie,S))||-.001,X=fe-D||(D-=.01)&&.001,T=0,$=$e;$--;)Q=I[$],st=Q.pin,st&&Q.start-Q._pinPush<D&&!S&&Q.end>0&&(G=Q.end-Q.start,(st===h||st===pe)&&!ar(B)&&(T+=G*(1-Q.progress)),st===d&&(Z+=G));if(D+=T,fe+=T,l._pinPush=Z,Re&&T&&(G={},G[C.a]="+="+T,pe&&(G[C.p]="-="+F()),x.set([Re,je],G)),d)G=rt(d),At=C===oe,zt=F(),ke=parseFloat(mt(C.a))+Z,!ie&&fe>1&&((ue?q:k).style["overflow-"+C.a]="scroll"),jr(d,we,G),Lt=Ar(d),J=at(d,!0),Xr=le&&Ct(k,At?Ee:oe)(),p&&(_t=[p+C.os2,X+Z+be],_t.t=we,$=p===ee?ii(d,C)+X+Z:0,$&&_t.push(C.d,$+be),mr(_t),le&&F(Je)),le&&(ne={top:J.top+(At?zt-D:Xr)+be,left:J.left+(At?Xr:zt-D)+be,boxSizing:"border-box",position:"fixed"},ne[Rt]=ne["max"+qt]=Math.ceil(J.width)+be,ne[kt]=ne["max"+ui]=Math.ceil(J.height)+be,ne[Ye]=ne[Ye+pr]=ne[Ye+fr]=ne[Ye+gr]=ne[Ye+hr]="0",ne[ee]=G[ee],ne[ee+pr]=G[ee+pr],ne[ee+fr]=G[ee+fr],ne[ee+gr]=G[ee+gr],ne[ee+hr]=G[ee+hr],gt=In(pt,ne,_e),tt&&F(0)),i?(hi=i._initted,Wr(1),i.render(i.duration(),!0,!0),he=mt(C.a)-ke+X+Z,X!==he&&le&&gt.splice(gt.length-2,2),i.render(0,!0,!0),hi||i.invalidate(!0),i.parent||i.totalTime(i.totalTime()),Wr(0)):he=X;else if(h&&F()&&!S)for(J=h.parentNode;J&&J!==q;)J._pinOffset&&(D-=J._pinOffset,fe-=J._pinOffset),J=J.parentNode;rr&&rr.forEach(function(en){return en.revert(!1,!0)}),l.start=D,l.end=fe,Me=ze=tt?Je:F(),!S&&!tt&&(Me<Je&&F(Je),l.scroll.rec=0),l.revert(!1,!0),We&&(ft=-1,l.isActive&&F(D+X*Ze),We.restart(!0)),ge=0,i&&L&&(i._initted||It)&&i.progress()!==It&&i.progress(It,!0).render(i.time(),!0,!0),(Ze!==l.progress||S)&&(i&&!L&&i.totalProgress(Ze,!0),l.progress=(Me-D)/X===Ze?0:Ze),d&&p&&(we._pinOffset=Math.round(l.progress*he)),m&&m(l)}},l.getVelocity=function(){return(F()-ze)/(Ce()-Mr)*1e3||0},l.endAnimation=function(){nr(l.callbackAnimation),i&&(O?O.progress(1):i.paused()?L||nr(i,l.direction<0,1):nr(i,i.reversed()))},l.labelToScroll=function(u){return i&&i.labels&&(D||l.refresh()||D)+i.labels[u]/i.duration()*X||0},l.getTrailing=function(u){var _=I.indexOf(l),v=l.direction>0?I.slice(0,_).reverse():I.slice(_+1);return(Ue(u)?v.filter(function(y){return y.vars.preventOverlaps===u}):v).filter(function(y){return l.direction>0?y.end<=D:y.start>=fe})},l.update=function(u,_,v){if(!(S&&!v&&!u)){var y=tt?Je:l.scroll(),ie=u?0:(y-D)/X,T=ie<0?0:ie>1?1:ie||0,Z=l.progress,W,Qe,B,pe,$e,$,G,J;if(_&&(ze=Me,Me=S?F():y,P&&(Bt=Et,Et=i&&!L?i.totalProgress():T)),H&&!T&&d&&!ge&&!wr&&Ne&&D<y+(y-ze)/(Ce()-Mr)*H&&(T=1e-4),T!==Z&&l.enabled){if(W=l.isActive=!!T&&T<1,Qe=!!Z&&Z<1,$=W!==Qe,$e=$||!!T!=!!Z,l.direction=T>Z?1:-1,l.progress=T,$e&&!ge&&(B=T&&!Z?0:T===1?1:Z===1?2:3,L&&(pe=!$&&ve[B+1]!=="none"&&ve[B+1]||ve[B],J=i&&(pe==="complete"||pe==="reset"||pe in i))),Xe&&($||J)&&(J||g||!i)&&(Be(Xe)?Xe(l):l.getTrailing(Xe).forEach(function(Q){return Q.endAnimation()})),L||(O&&!ge&&!wr?((S||Mt&&Mt!==l)&&O.render(O._dp._time-O._start),O.resetTo?O.resetTo("totalProgress",T,i._tTime/i._tDur):(O.vars.totalProgress=T,O.invalidate().restart())):i&&i.totalProgress(T,!!ge)),d){if(u&&p&&(we.style[p+C.os2]=Jt),!le)K(sr(ke+he*T));else if($e){if(G=!u&&T>Z&&fe+1>y&&y+1>=bt(k,C),_e)if(!u&&(W||G)){var zt=at(d,!0),At=y-D;Ci(d,q,zt.top+(C===oe?At:0)+be,zt.left+(C===oe?0:At)+be)}else Ci(d,we);mr(W||G?gt:Lt),he!==X&&T<1&&W||K(ke+(T===1&&!G?he:0))}}P&&!de.tween&&!ge&&!wr&&We.restart(!0),s&&($||j&&T&&(T<1||!$r))&&Fr(s.targets).forEach(function(Q){return Q.classList[W||j?"add":"remove"](s.className)}),a&&!L&&!u&&a(l),$e&&!ge?(L&&(J&&(pe==="complete"?i.pause().totalProgress(1):pe==="reset"?i.restart(!0).pause():pe==="restart"?i.restart(!0):i[pe]()),a&&a(l)),($||!$r)&&(w&&$&&Ur(l,w),V[B]&&Ur(l,V[B]),j&&(T===1?l.kill(!1,1):V[B]=0),$||(B=T===1?1:3,V[B]&&Ur(l,V[B]))),Pe&&!W&&Math.abs(l.getVelocity())>(ar(Pe)?Pe:2500)&&(nr(l.callbackAnimation),O?O.progress(1):nr(i,pe==="reverse"?1:!T,1))):L&&a&&!ge&&a(l)}if(Qt){var ne=S?y/S.duration()*(S._caScrollDist||0):y;Ke(ne+(ye._isFlipped?1:0)),Qt(ne)}Ht&&Ht(-y/S.duration()*(S._caScrollDist||0))}},l.enable=function(u,_){l.enabled||(l.enabled=!0,ce(k,"resize",lr),ce(ue?U:k,"scroll",Yt),He&&ce(o,"refreshInit",He),u!==!1&&(l.progress=Ze=0,Me=ze=ft=F()),_!==!1&&l.refresh())},l.getTween=function(u){return u&&de?de.tween:O},l.setPositions=function(u,_){d&&(ke+=u-D,he+=_-u-X),l.start=D=u,l.end=fe=_,X=_-u,l.update()},l.disable=function(u,_){if(l.enabled&&(u!==!1&&l.revert(!0,!0),l.enabled=l.isActive=!1,_||O&&O.pause(),Je=0,xe&&(xe.uncache=1),He&&se(o,"refreshInit",He),We&&(We.pause(),de.tween&&de.tween.kill()&&(de.tween=0)),!ue)){for(var v=I.length;v--;)if(I[v].scroller===k&&I[v]!==l)return;se(k,"resize",lr),se(k,"scroll",Yt)}},l.kill=function(u,_){l.disable(u,_),O&&!_&&O.kill(),f&&delete ni[f];var v=I.indexOf(l);v>=0&&I.splice(v,1),v===Se&&Or>0&&Se--,v=0,I.forEach(function(y){return y.scroller===l.scroller&&(v=1)}),v||tt||(l.scroll.rec=0),i&&(i.scrollTrigger=null,u&&i.revert({kill:!1}),_||i.kill()),Re&&[Re,je,ye,c].forEach(function(y){return y.parentNode&&y.parentNode.removeChild(y)}),Mt===l&&(Mt=0),d&&(xe&&(xe.uncache=1),v=0,I.forEach(function(y){return y.pin===d&&v++}),v||(xe.spacer=0)),t.onKill&&t.onKill(l)},l.enable(!1,!1),ot&&ot(l),!i||!i.add||X?l.refresh():x.delayedCall(.01,function(){return D||fe||l.refresh()})&&(X=.01)&&(D=fe=0)},o.register=function(t){return Nt||(x=t||$i(),Wi()&&window.document&&o.enable(),Nt=Tr),Nt},o.defaults=function(t){if(t)for(var i in t)Er[i]=t[i];return Er},o.disable=function(t,i){Tr=0,I.forEach(function(a){return a[i?"kill":"disable"](t)}),se(A,"wheel",Yt),se(U,"scroll",Yt),clearInterval(yr),se(U,"touchcancel",et),se(q,"touchstart",et),Sr(se,U,"pointerdown,touchstart,mousedown",vi),Sr(se,U,"pointerup,touchend,mouseup",xi),zr.kill(),br(se);for(var n=0;n<M.length;n+=3)Cr(se,M[n],M[n+1]),Cr(se,M[n],M[n+2])},o.enable=function(){if(A=window,U=document,ct=U.documentElement,q=U.body,x&&(Fr=x.utils.toArray,$t=x.utils.clamp,ri=x.core.context||et,Wr=x.core.suppressOverwrites||et,ai=A.history.scrollRestoration||"auto",x.core.globals("ScrollTrigger",o),q)){Tr=1,te.register(x),o.isTouch=te.isTouch,yt=te.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),ce(A,"wheel",Yt),Hi=[A,U,ct,q],x.matchMedia?(o.matchMedia=function(f){var w=x.matchMedia(),m;for(m in f)w.add(m,f[m]);return w},x.addEventListener("matchMediaInit",function(){return fi()}),x.addEventListener("matchMediaRevert",function(){return Zi()}),x.addEventListener("matchMedia",function(){Gt(0,1),Ot("matchMedia")}),x.matchMedia("(orientation: portrait)",function(){return qr(),qr})):console.warn("Requires GSAP 3.11.0 or later"),qr(),ce(U,"scroll",Yt);var t=q.style,i=t.borderTopStyle,n=x.core.Animation.prototype,a,s;for(n.revert||Object.defineProperty(n,"revert",{value:function(){return this.time(-.01,!0)}}),t.borderTopStyle="solid",a=at(q),oe.m=Math.round(a.top+oe.sc())||0,Ee.m=Math.round(a.left+Ee.sc())||0,i?t.borderTopStyle=i:t.removeProperty("border-top-style"),yr=setInterval(Ti,250),x.delayedCall(.5,function(){return wr=0}),ce(U,"touchcancel",et),ce(q,"touchstart",et),Sr(ce,U,"pointerdown,touchstart,mousedown",vi),Sr(ce,U,"pointerup,touchend,mouseup",xi),ti=x.utils.checkPrefix("transform"),Lr.push(ti),Nt=Ce(),zr=x.delayedCall(.2,Gt).pause(),Xt=[U,"visibilitychange",function(){var f=A.innerWidth,w=A.innerHeight;U.hidden?(mi=f,_i=w):(mi!==f||_i!==w)&&lr()},U,"DOMContentLoaded",Gt,A,"load",Gt,A,"resize",lr],br(ce),I.forEach(function(f){return f.enable(0,1)}),s=0;s<M.length;s+=3)Cr(se,M[s],M[s+1]),Cr(se,M[s],M[s+2])}},o.config=function(t){"limitCallbacks"in t&&($r=!!t.limitCallbacks);var i=t.syncInterval;i&&clearInterval(yr)||(yr=i)&&setInterval(Ti,i),"ignoreMobileResize"in t&&(Yi=o.isTouch===1&&t.ignoreMobileResize),"autoRefreshEvents"in t&&(br(se)||br(ce,t.autoRefreshEvents||"none"),Fi=(t.autoRefreshEvents+"").indexOf("resize")===-1)},o.scrollerProxy=function(t,i){var n=Ae(t),a=M.indexOf(n),s=Dt(n);~a&&M.splice(a,s?6:2),i&&(s?it.unshift(A,i,q,i,ct,i):it.unshift(n,i))},o.clearMatchMedia=function(t){I.forEach(function(i){return i._ctx&&i._ctx.query===t&&i._ctx.kill(!0,!0)})},o.isInViewport=function(t,i,n){var a=(Ue(t)?Ae(t):t).getBoundingClientRect(),s=a[n?Rt:kt]*i||0;return n?a.right-s>0&&a.left+s<A.innerWidth:a.bottom-s>0&&a.top+s<A.innerHeight},o.positionInViewport=function(t,i,n){Ue(t)&&(t=Ae(t));var a=t.getBoundingClientRect(),s=a[n?Rt:kt],f=i==null?s/2:i in Yr?Yr[i]*s:~i.indexOf("%")?parseFloat(i)*s/100:parseFloat(i)||0;return n?(a.left+f)/A.innerWidth:(a.top+f)/A.innerHeight},o.killAll=function(t){if(I.forEach(function(n){return n.vars.id!=="ScrollSmoother"&&n.kill()}),t!==!0){var i=Vt.killAll||[];Vt={},i.forEach(function(n){return n()})}},o}();b.version="3.11.2";b.saveStyles=function(o){return o?Fr(o).forEach(function(e){if(e&&e.style){var r=Oe.indexOf(e);r>=0&&Oe.splice(r,5),Oe.push(e,e.style.cssText,e.getBBox&&e.getAttribute("transform"),x.core.getCache(e),ri())}}):Oe};b.revert=function(o,e){return fi(!o,e)};b.create=function(o,e){return new b(o,e)};b.refresh=function(o){return o?lr():(Nt||b.register())&&Gt(!0)};b.update=jt;b.clearScrollMemory=Ji;b.maxScroll=function(o,e){return bt(o,e?Ee:oe)};b.getScrollFunc=function(o,e){return Ct(Ae(o),e?Ee:oe)};b.getById=function(o){return ni[o]};b.getAll=function(){return I.filter(function(o){return o.vars.id!=="ScrollSmoother"})};b.isScrolling=function(){return!!Ne};b.snapDirectional=di;b.addEventListener=function(o,e){var r=Vt[o]||(Vt[o]=[]);~r.indexOf(e)||r.push(e)};b.removeEventListener=function(o,e){var r=Vt[o],t=r&&r.indexOf(e);t>=0&&r.splice(t,1)};b.batch=function(o,e){var r=[],t={},i=e.interval||.016,n=e.batchMax||1e9,a=function(w,m){var g=[],h=[],d=x.delayedCall(i,function(){m(g,h),g=[],h=[]}).pause();return function(p){g.length||d.restart(!0),g.push(p.trigger),h.push(p),n<=g.length&&d.progress(1)}},s;for(s in e)t[s]=s.substr(0,2)==="on"&&Be(e[s])&&s!=="onRefreshInit"?a(s,e[s]):e[s];return Be(n)&&(n=n(),ce(b,"refresh",function(){return n=e.batchMax()})),Fr(o).forEach(function(f){var w={};for(s in t)w[s]=t[s];w.trigger=f,r.push(b.create(w))}),r};var Ii=function(e,r,t,i){return r>i?e(i):r<0&&e(0),t>i?(i-r)/(t-r):t<0?r/(r-t):1},Kr=function o(e,r){r===!0?e.style.removeProperty("touch-action"):e.style.touchAction=r===!0?"auto":r?"pan-"+r+(te.isTouch?" pinch-zoom":""):"none",e===ct&&o(q,r)},Ai={auto:1,scroll:1},Pn=function(e){var r=e.event,t=e.target,i=e.axis,n=(r.changedTouches?r.changedTouches[0]:r).target,a=n._gsap||x.core.getCache(n),s=Ce(),f;if(!a._isScrollT||s-a._isScrollT>2e3){for(;n&&n.scrollHeight<=n.clientHeight;)n=n.parentNode;a._isScroll=n&&!Dt(n)&&n!==t&&(Ai[(f=rt(n)).overflowY]||Ai[f.overflowX]),a._isScrollT=s}(a._isScroll||i==="x")&&(r.stopPropagation(),r._gsapAllow=!0)},Qi=function(e,r,t,i){return te.create({target:e,capture:!0,debounce:!1,lockAxis:!0,type:r,onWheel:i=i&&Pn,onPress:i,onDrag:i,onScroll:i,onEnable:function(){return t&&ce(U,te.eventTypes[0],Mi,!1,!0)},onDisable:function(){return se(U,te.eventTypes[0],Mi,!0)}})},Mn=/(input|label|select|textarea)/i,Pi,Mi=function(e){var r=Mn.test(e.target.tagName);(r||Pi)&&(e._gsapAllow=!0,Pi=r)},Rn=function(e){Rr(e)||(e={}),e.preventDefault=e.isNormalizer=e.allowClicks=!0,e.type||(e.type="wheel,touch"),e.debounce=!!e.debounce,e.id=e.id||"normalizer";var r=e,t=r.normalizeScrollX,i=r.momentum,n=r.allowNestedScroll,a,s,f=Ae(e.target)||ct,w=x.core.globals().ScrollSmoother,m=w&&w.get(),g=yt&&(e.content&&Ae(e.content)||m&&e.content!==!1&&!m.smooth()&&m.content()),h=Ct(f,oe),d=Ct(f,Ee),p=1,Y=(te.isTouch&&A.visualViewport?A.visualViewport.scale*A.visualViewport.width:A.outerWidth)/A.innerWidth,H=0,E=Be(i)?function(){return i(a)}:function(){return i||2.8},ae,j,P=Qi(f,e.type,!0,n),_e=function(){return j=!1},N=et,S=et,Pe=function(){s=bt(f,oe),S=$t(yt?1:0,s),t&&(N=$t(0,bt(f,Ee))),ae=Vr},Xe=function(){g._gsap.y=sr(parseFloat(g._gsap.y)+h.offset)+"px",g.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(g._gsap.y)+", 0, 1)",h.offset=h.cacheID=0},C=function(){if(j){requestAnimationFrame(_e);var ve=sr(a.deltaY/2),z=S(h.v-ve);if(g&&z!==h.v+h.offset){h.offset=z-h.v;var re=sr((parseFloat(g&&g._gsap.y)||0)-h.offset);g.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+re+", 0, 1)",g._gsap.y=re+"px",h.cacheID=M.cache,jt()}return!0}h.offset&&Xe(),j=!0},L,k,qe,ue,le=function(){Pe(),L.isActive()&&L.vars.scrollY>s&&(h()>s?L.progress(1)&&h(s):L.resetTo("scrollY",s))};return g&&x.set(g,{y:"+=0"}),e.ignoreCheck=function(V){return yt&&V.type==="touchmove"&&C()||p>1.05&&V.type!=="touchstart"||a.isGesturing||V.touches&&V.touches.length>1},e.onPress=function(){var V=p;p=sr((A.visualViewport&&A.visualViewport.scale||1)/Y),L.pause(),V!==p&&Kr(f,p>1.01?!0:t?!1:"x"),k=d(),qe=h(),Pe(),ae=Vr},e.onRelease=e.onGestureStart=function(V,ve){if(h.offset&&Xe(),!ve)ue.restart(!0);else{M.cache++;var z=E(),re,l;t&&(re=d(),l=re+z*.05*-V.velocityX/.227,z*=Ii(d,re,l,bt(f,Ee)),L.vars.scrollX=N(l)),re=h(),l=re+z*.05*-V.velocityY/.227,z*=Ii(h,re,l,bt(f,oe)),L.vars.scrollY=S(l),L.invalidate().duration(z).play(.01),(yt&&L.vars.scrollY>=s||re>=s-1)&&x.to({},{onUpdate:le,duration:z})}},e.onWheel=function(){L._ts&&L.pause(),Ce()-H>1e3&&(ae=0,H=Ce())},e.onChange=function(V,ve,z,re,l){if(Vr!==ae&&Pe(),ve&&t&&d(N(re[2]===ve?k+(V.startX-V.x):d()+ve-re[1])),z){h.offset&&Xe();var He=l[2]===z,ut=He?qe+V.startY-V.y:h()+z-l[1],dt=S(ut);He&&ut!==dt&&(qe+=dt-ut),h(dt)}(z||ve)&&jt()},e.onEnable=function(){Kr(f,t?!1:"x"),b.addEventListener("refresh",le),ce(A,"resize",le),h.smooth&&(h.target.style.scrollBehavior="auto",h.smooth=d.smooth=!1),P.enable()},e.onDisable=function(){Kr(f,!0),se(A,"resize",le),b.removeEventListener("refresh",le),P.kill()},e.lockAxis=e.lockAxis!==!1,a=new te(e),a.iOS=yt,yt&&!h()&&h(1),yt&&x.ticker.add(et),ue=a._dc,L=x.to(a,{ease:"power4",paused:!0,scrollX:t?"+=0.1":"+=0",scrollY:"+=0.1",onComplete:ue.vars.onComplete}),a};b.sort=function(o){return I.sort(o||function(e,r){return(e.vars.refreshPriority||0)*-1e6+e.start-(r.start+(r.vars.refreshPriority||0)*-1e6)})};b.observe=function(o){return new te(o)};b.normalizeScroll=function(o){if(typeof o>"u")return Fe;if(o===!0&&Fe)return Fe.enable();if(o===!1)return Fe&&Fe.kill();var e=o instanceof te?o:Rn(o);return Fe&&Fe.target===e.target&&Fe.kill(),Dt(e.target)&&(Fe=e),e};b.core={_getVelocityProp:ei,_inputObserver:Qi,_scrollers:M,_proxies:it,bridge:{ss:function(){Ne||Ot("scrollStart"),Ne=Ce()},ref:function(){return ge}}};$i()&&x.registerPlugin(b);hn.registerPlugin(b);class kn{constructor(e){this.stage=e,this.geometry,this.material,this.mesh,this.loader=new cn,this.imageConfigs=[{id:"img01",path:"./img01.jpg",greyPath:"./grey01.jpg",videoPath:"./webm/1.webm"},{id:"img02",path:"./img02.jpg",greyPath:"./grey02.jpg",videoPath:"./webm/2.webm"},{id:"img03",path:"./img03.jpg",greyPath:"./grey03.jpg",videoPath:"./webm/3.webm"},{id:"img04",path:"./img04.jpg",greyPath:"./grey04.jpg",videoPath:"./webm/4.webm"},{id:"img05",path:"./img05.jpg",greyPath:"./grey05.jpg",videoPath:"./webm/5.webm"},{id:"img06",path:"./img06.jpg",greyPath:"./grey06.jpg",videoPath:"./webm/6.webm"}],this.textures={},this.greyTextures={},this.videos={},this.videoProgress={},this.videoTimers={},this.activeVideoId=null,this.currentImageIndex=0,this.previousImageIndex=0,this.activeSectionIndex=0,this.currentDisplacement=null,this.globalScrollStartHandler=null,this.globalScrollEndHandler=null,this.isScrolling=!1,this.sectionTriggers=[],this.transitionTriggers=[],this.blurTriggers=[],this.activeTransitionIndex=null,this.mouse=new _r(0,0),this.width=window.innerWidth,this.height=window.innerHeight,this.cssVariableRoot=typeof document<"u"?document.documentElement:null,this.defaultImageAspect=3/2}_init(){this.createMesh(),this.initVideos(),this.registerGlobalScrollEvents(),this.setupScrollTriggers(),this.updateMediaBounds()}createMesh(){const e={x:2,y:2},r=`?v=${Date.now()}`;this.imageConfigs.forEach((n,a)=>{this.textures[n.id]=this.loader.load(`${n.path}${r}`),this.greyTextures[n.id]=this.loader.load(`${n.greyPath}${r}`)}),this.currentDisplacement=this.greyTextures.img01,this.disp=this.currentDisplacement;const t=[this.textures.img01,this.textures.img02,this.textures.img03,this.textures.img04,this.textures.img05,this.textures.img06],i={uResolution:{value:new _r(this.width,this.height)},uImageResolution:{value:new _r(this.getAssetAspect(0),1)},uTextures:{value:t},uCurrentIndex:{value:0},uTargetIndex:{value:0},uTransition:{value:0},disp:{value:this.disp},uTime:{value:0},uAmplitude:{value:1},uBounce:{value:new _r(0,0)}};this.geometry=new un(e.x,e.y,100,100),this.material=new dn({uniforms:i,vertexShader:gn,fragmentShader:mn}),this.mesh=new fn(this.geometry,this.material),this.stage.scene.add(this.mesh)}selectDisplacementTexture(e){const r=this.imageConfigs[e],t=this.greyTextures[r.id];t&&this.mesh&&this.mesh.material&&(this.currentDisplacement=t,this.mesh.material.uniforms.disp.value=t)}updateCurrentImageIndex(e){this.previousImageIndex=this.currentImageIndex,this.currentImageIndex=e}registerGlobalScrollEvents(){this.globalScrollStartHandler||(this.globalScrollStartHandler=()=>this.handleScrollStart(),b.addEventListener("scrollStart",this.globalScrollStartHandler)),this.globalScrollEndHandler||(this.globalScrollEndHandler=()=>this.handleScrollEnd(),b.addEventListener("scrollEnd",this.globalScrollEndHandler))}handleScrollStart(){this.isScrolling=!0,this.cancelAllVideoTimers(),this.stopAllVideos()}handleScrollEnd(){this.isScrolling=!1;const e=this.findClosestSectionToCenter();this.setActiveSection(e),this.stopVideosExcept(e),this.cancelVideoTimersExcept(e),this.requestVideoPlayIfInRange(e),this.updateAllSubtitleBlur(),this.updateMediaBounds(e)}setupScrollTriggers(){this.sectionTriggers.forEach(e=>e.kill()),this.transitionTriggers.forEach(e=>e.kill()),this.blurTriggers.forEach(e=>e.kill()),this.sectionTriggers=[],this.transitionTriggers=[],this.blurTriggers=[],this.imageConfigs.forEach((e,r)=>{const t=`#sec${String(r+1).padStart(2,"0")}`,i=b.create({trigger:t,start:"top top",end:"bottom top",onEnter:()=>{this.handleSectionEnter(r)},onEnterBack:()=>{this.handleSectionEnter(r)},onLeave:()=>{this.handleSectionLeave(r)},onLeaveBack:()=>{this.handleSectionLeave(r)},invalidateOnRefresh:!0});this.sectionTriggers.push(i);const n=b.create({trigger:t,start:"top bottom",end:"bottom top",scrub:!0,onUpdate:()=>{this.updateSubtitleBlur(r)},invalidateOnRefresh:!0});if(this.blurTriggers.push(n),this.updateSubtitleBlur(r),r>0){const a=`#sec${String(r).padStart(2,"0")}`,s=document.querySelector(`${a} h2`),f=document.querySelector(`${t} h2`);if(!s||!f)return;const w=b.create({trigger:s,start:"center 40%",endTrigger:f,end:"center 60%",scrub:!0,onUpdate:m=>{this.applyScrollTransition(r-1,r,m.progress,m.direction||1)},onToggle:m=>{if(!m.isActive){const g=m.direction||(m.progress>=.5?1:-1),h=m.progress>=.5?1:0;this.applyScrollTransition(r-1,r,h,g)}},invalidateOnRefresh:!0});this.transitionTriggers.push(w),this.applyScrollTransition(r-1,r,w.progress||0)}}),b.refresh(),this.syncActiveSectionOnInit(),this.updateAllSubtitleBlur()}syncActiveSectionOnInit(){const e=this.findClosestSectionToCenter();this.setActiveSection(e)}findClosestSectionToCenter(){const e=window.innerHeight/2;let r=0,t=Number.POSITIVE_INFINITY;return this.imageConfigs.forEach((i,n)=>{const{textElement:a,section:s}=this.getSectionElements(n),f=a||s;if(!f)return;const w=f.getBoundingClientRect(),m=w.top+w.height/2,g=Math.abs(m-e);g<t&&(t=g,r=n)}),r}setActiveSection(e){const r=this.imageConfigs.length-1,t=Math.min(Math.max(e,0),r);if(this.activeSectionIndex=t,this.currentImageIndex=t,this.previousImageIndex=Math.max(t-1,0),this.selectDisplacementTexture(t),this.activeTransitionIndex=null,this.mesh&&this.mesh.material){const i=this.mesh.material.uniforms;if(i.uCurrentIndex.value=t,i.uTargetIndex&&(i.uTargetIndex.value=t),i.uTransition.value=0,i.uImageResolution&&i.uImageResolution.value&&typeof i.uImageResolution.value.set=="function"){const n=this.getAssetAspect(t);i.uImageResolution.value.set(n,1)}}this.updateMediaBounds(t)}getDisplayedIndex(){if(typeof this.currentImageIndex!="number")return 0;const e=this.imageConfigs.length-1;return Math.min(Math.max(this.currentImageIndex,0),e)}handleSectionEnter(e){this.activeSectionIndex=e,this.stopVideosExcept(e),this.cancelVideoTimersExcept(e),this.cancelVideoTimer(this.imageConfigs[e].id),this.hideVideoAndShowStillFrame(this.imageConfigs[e].id),this.updateSubtitleBlur(e),this.updateMediaBounds(e)}handleSectionLeave(e){const r=this.imageConfigs[e];this.cancelVideoTimer(r.id),this.stopVideo(r.id),this.updateSubtitleBlur(e)}applyScrollTransition(e,r,t,i=1){if(!this.mesh||!this.mesh.material)return;const n=this.mesh.material.uniforms,a=this.imageConfigs.length-1,s=Math.min(Math.max(e,0),a),f=Math.min(Math.max(r,0),a),w=i<0,m=w?f:s,g=w?s:f,h=this.imageConfigs[m],d=this.imageConfigs[g],p=w?1-t:t;if(p<=0){n.uCurrentIndex.value=m,n.uTargetIndex&&(n.uTargetIndex.value=m),n.uTransition.value=0,this.previousImageIndex=Math.max(m-1,0),this.currentImageIndex=m,this.selectDisplacementTexture(m),this.activeTransitionIndex=null,this.cancelVideoTimersExcept(m),this.stopVideosExcept(m);return}if(p>=1){n.uCurrentIndex.value=g,n.uTargetIndex&&(n.uTargetIndex.value=g),n.uTransition.value=0,this.previousImageIndex=Math.max(g-1,0),this.currentImageIndex=g,this.selectDisplacementTexture(g),this.activeTransitionIndex=null,h&&(this.cancelVideoTimer(h.id),this.stopVideo(h.id)),this.cancelVideoTimersExcept(g),this.stopVideosExcept(g);return}n.uCurrentIndex.value=m,n.uTargetIndex&&(n.uTargetIndex.value=g),n.uTransition.value=p,this.currentImageIndex=p>=.5?g:m,this.previousImageIndex=p>=.5?m:Math.max(m-1,0),this.selectDisplacementTexture(g),p>=.5?h&&(this.cancelVideoTimer(h.id),this.stopVideo(h.id)):d&&(this.cancelVideoTimer(d.id),this.stopVideo(d.id)),this.activeTransitionIndex=g}onLoop(){this.mesh.material.uniforms.uTime.value+=.001}onResize(){this.width=window.innerWidth,this.height=window.innerHeight,this.mesh.material.uniforms.uResolution.value.set(this.width,this.height),this.updateAllSubtitleBlur(),this.updateMediaBounds()}initVideos(){this.imageConfigs.forEach(e=>{this.createVideoElement(e),this.videoProgress[e.id]=0})}createVideoElement(e){const r=document.createElement("video");r.src=e.videoPath,r.className="video-overlay",r.muted=!0,r.loop=!1,r.preload="metadata",r.style.display="none",document.body.appendChild(r),this.videos[e.id]=r,this.setupVideoEvents(r,e.id)}setupVideoEvents(e,r){e.addEventListener("loadedmetadata",()=>{console.log(`\u89C6\u9891 ${r} \u5143\u6570\u636E\u52A0\u8F7D\u5B8C\u6210`)}),e.addEventListener("timeupdate",()=>{this.videoProgress[r]=e.currentTime}),e.addEventListener("ended",()=>{this.hideVideoAndShowStillFrame(r),this.activeVideoId===r&&(this.activeVideoId=null)})}requestVideoPlayIfInRange(e){const r=this.imageConfigs[e];if(!r)return;const{textElement:t}=this.getSectionElements(e);if(!t)return;const i=this.getTextNormalizedPosition(t);i>=.4&&i<=.6?this.scheduleVideoPlay(r.id):this.cancelVideoTimer(r.id)}getSectionElements(e){const r=`#sec${String(e+1).padStart(2,"0")}`,t=document.querySelector(r),i=t?t.querySelector("h2"):null;return{section:t,textElement:i}}getTextNormalizedPosition(e){const r=e.getBoundingClientRect(),t=window.innerHeight||1;return(r.top+r.height/2)/t}computeBlurAmount(e){const r=Math.max(0,Math.min(1,e)),t=12;if(r<=.2||r>=.8)return t;if(r<.4){const i=(r-.2)/.2;return t*(1-i)}if(r<=.6)return 0;if(r<.8){const i=(r-.6)/.2;return t*i}return t}applyBlurToSubtitle(e,r){e.style.filter=`blur(${r.toFixed(2)}px)`}updateSubtitleBlur(e){const{textElement:r}=this.getSectionElements(e);if(!r)return;const t=this.getTextNormalizedPosition(r),i=this.computeBlurAmount(t);this.applyBlurToSubtitle(r,i)}updateAllSubtitleBlur(){this.imageConfigs.forEach((e,r)=>{this.updateSubtitleBlur(r)})}getAssetAspect(e){const r=this.imageConfigs[e];return r&&typeof r.aspect=="number"&&r.aspect>0?r.aspect:this.defaultImageAspect}updateMediaBounds(e=this.getDisplayedIndex()){if(!this.cssVariableRoot)return;(!this.width||!this.height)&&(this.width=window.innerWidth,this.height=window.innerHeight);const r=this.height?this.width/this.height:1,t=this.getAssetAspect(e);let i=1,n=1;if(r>0&&t>0){const a=Math.min(r/t,1),s=Math.min(t/r,1);i=a>0?1/a:1,n=s>0?1/s:1}this.cssVariableRoot.style.setProperty("--media-scale-x",i.toFixed(6)),this.cssVariableRoot.style.setProperty("--media-scale-y",n.toFixed(6))}scheduleVideoPlay(e){const r=this.videos[e];!r||!r.paused&&!r.ended&&r.currentTime>0||(this.cancelVideoTimer(e),this.videoTimers[e]=setTimeout(()=>{this.playVideoIfCurrent(e)},1500))}cancelVideoTimer(e){this.videoTimers[e]&&(clearTimeout(this.videoTimers[e]),delete this.videoTimers[e])}cancelAllVideoTimers(){Object.keys(this.videoTimers).forEach(e=>{this.cancelVideoTimer(e)})}resolveVideoId(e){if(typeof e=="string")return e;if(typeof e=="number"){const r=this.imageConfigs[e];return r?r.id:null}return null}cancelVideoTimersExcept(e){const r=this.resolveVideoId(e);this.imageConfigs.forEach(t=>{(!r||t.id!==r)&&this.cancelVideoTimer(t.id)})}stopVideosExcept(e){const r=this.resolveVideoId(e);this.imageConfigs.forEach(t=>{(!r||t.id!==r)&&this.stopVideo(t.id)})}playVideo(e){const r=this.videos[e];if(!!r)try{this.cancelVideoTimer(e),r.paused||r.pause(),r.currentTime=0,r.style.display="block",r.classList.add("playing");const t=r.play();t!==void 0&&t.then(()=>{r.style.opacity="1",this.activeVideoId=e,console.log(`\u89C6\u9891 ${e} \u5F00\u59CB\u64AD\u653E`)}).catch(i=>{i.name==="AbortError"?console.log(`\u89C6\u9891 ${e} \u64AD\u653E\u88AB\u4E2D\u65AD`):console.error(`\u89C6\u9891 ${e} \u64AD\u653E\u5931\u8D25:`,i),this.hideVideoAndShowStillFrame(e)})}catch(t){console.error(`\u89C6\u9891 ${e} \u64AD\u653E\u5F02\u5E38:`,t),this.hideVideoAndShowStillFrame(e)}}stopVideo(e){const r=this.videos[e];if(!!r)try{if(r.paused&&r.currentTime===0&&r.style.display==="none")return;r.paused||r.pause(),r.currentTime=0,r.classList.remove("playing"),r.style.opacity="0",setTimeout(()=>{r.paused&&(r.style.display="none")},300),this.activeVideoId===e&&(this.activeVideoId=null),console.log(`\u89C6\u9891 ${e} \u5DF2\u505C\u6B62`)}catch(t){console.error(`\u89C6\u9891 ${e} \u505C\u6B62\u5F02\u5E38:`,t)}}hideVideoAndShowStillFrame(e){const r=this.videos[e];if(!!r){if(r.style.display==="none"&&r.style.opacity==="0"){this.activeVideoId===e&&(this.activeVideoId=null);return}r.classList.remove("playing"),r.style.opacity="0",setTimeout(()=>{r.style.display="none",this.activeVideoId===e&&(this.activeVideoId=null)},300)}}stopAllVideos(){this.imageConfigs.forEach(e=>{this.cancelVideoTimer(e.id),this.stopVideo(e.id)})}getIndexByVideoId(e){return this.imageConfigs.findIndex(r=>r.id===e)}playVideoIfCurrent(e){const r=this.getIndexByVideoId(e);r!==-1&&this.getDisplayedIndex()===r&&this.playVideo(e)}}let or,Pr,Ri;function Dn(){Ri=new pn({duration:2,smoothWheel:!0,smoothTouch:!0,wheelMultiplier:.5,touchMultiplier:.5,infinite:!1}),or=new Ve,Pr=new kn(or),or._init(),Pr._init(),window.addEventListener("resize",()=>{or.onResize(),Pr.onResize()});const o=e=>{requestAnimationFrame(o),Ri.raf(e),or.onLoop(),Pr.onLoop()};o()}window.addEventListener("DOMContentLoaded",Dn);
